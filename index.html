<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IPv4 Subnetting Practice (VLSM)</title>

<style>
:root{
  --bg:#0b0f17;
  --bg2:#070a10;
  --card:#111827;
  --muted:#94a3b8;
  --text:#e5e7eb;
  --line:rgba(148,163,184,.18);
  --accent:#60a5fa;
  --good:#34d399;
  --bad:#fb7185;
}
*{ box-sizing:border-box; }
body{
  margin:0;
  background:linear-gradient(180deg, var(--bg), var(--bg2));
  color:var(--text);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
.container{
  max-width: 980px;
  margin: 28px auto;
  padding: 0 16px 56px;
}
h1{ margin:0; font-size:26px; }
.sub{ color:var(--muted); font-size:14px; margin-top:6px; }

.toolbar{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-top:16px;
}
label{ font-size:13px; color:var(--muted); display:block; margin-bottom:6px; }
select, input, button{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:rgba(17,24,39,.75);
  color:var(--text);
}
button{
  cursor:pointer;
  border-color: rgba(96,165,250,.35);
}
button.primary{
  background: linear-gradient(180deg, rgba(96,165,250,.28), rgba(96,165,250,.12));
}

.card{
  margin-top:16px;
  background:rgba(17,24,39,.6);
  border:1px solid var(--line);
  border-radius:16px;
  padding:14px;
}

.subnet{
  margin-top:14px;
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  background:rgba(17,24,39,.48);
}
.subnetHeader{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
.status{
  font-size:13px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--line);
}
.status.good{ color:var(--good); }
.status.bad{ color:var(--bad); }

.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}
@media(max-width:820px){
  .grid{ grid-template-columns:1fr; }
}

.small{ font-size:13px; color:var(--muted); }
code{
  background:rgba(148,163,184,.12);
  padding:2px 8px;
  border-radius:10px;
}
a{ color:var(--accent); text-decoration:none; }
a:hover{ text-decoration:underline; }
</style>
</head>

<body>
<div class="container">

<h1>IPv4 Subnetting Practice (VLSM)</h1>
<div class="sub">Answer each subnet: Mask, CIDR, Network ID, Broadcast, First usable (Gateway), Last usable</div>

<div class="toolbar">
  <div style="flex:1">
    <label>Difficulty</label>
    <select id="difficulty">
      <option value="easy">Easy (1 subnet)</option>
      <option value="medium">Medium (equal-size)</option>
      <option value="hard">Hard (VLSM)</option>
    </select>
  </div>
  <div style="flex:1">
    <label>&nbsp;</label>
    <button class="primary" onclick="newQuestion()">New Question</button>
  </div>
  <div style="flex:1">
    <label>&nbsp;</label>
    <button onclick="checkAnswers()">Check Answers</button>
  </div>
</div>

<div id="question" class="card" style="display:none;"></div>
<div id="inputs"></div>
<div id="result" class="card" style="display:none;"></div>

<script>
/* ---------- helpers ---------- */
const ipToInt = ip => ip.split('.').reduce((a,o)=>(a<<8)+(+o),0)>>>0;
const intToIp = n => [n>>>24,n>>>16&255,n>>>8&255,n&255].join('.');
const maskFromPrefix = p => p===0?0:(0xffffffff<<(32-p))>>>0;

const normalizeIp = v => { try{return intToIp(ipToInt(v.trim()));}catch{return null;} };
const normalizeCidr = v => v ? (v.trim().startsWith("/") ? v.trim() : "/" + v.trim()) : null;

function subnetInfo(net,p){
  const size = 2**(32-p);
  return {
    prefix:p,
    mask:intToIp(maskFromPrefix(p)),
    network:intToIp(net),
    broadcast:intToIp(net+size-1),
    gateway:intToIp(net+1),
    last:intToIp(net+size-2),
    blockSize:size
  };
}
function hostsToPrefix(h){ return 32 - Math.ceil(Math.log2(h+2)); }
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

/* ---------- state ---------- */
let current=[], expectedHosts=[], currentBase=null;

/* ---------- base selection ---------- */
function randomBaseGeneral(){
  const b=[["10.0.0.0",8],["172.16.0.0",16],["192.168.0.0",24]];
  const [ip,p]=b[rand(0,2)];
  return {net:ipToInt(ip),prefix:p};
}
function randomBaseMedium(){
  const r=Math.random();
  if(r<0.6) return {net:ipToInt("192.168.0.0"),prefix:24};
  if(r<0.9) return {net:ipToInt("172.16.0.0"),prefix:16};
  return {net:ipToInt("10.0.0.0"),prefix:8};
}

/* ---------- AI link ---------- */
function buildAiLink(base, hosts){
  const q =
`show a detailed, step-by-step walkthrough explaining how to subnet
${intToIp(base.net)}/${base.prefix}
into ${hosts.length} subnets
with host requirements ${hosts.join(", ")}.
Include how to determine subnet sizes, CIDR prefixes, network IDs,
broadcast addresses, and usable host ranges.`;

  return `https://www.google.com/search?udm=50&aep=11&q=${encodeURIComponent(q)}`;
}


/* ---------- generation ---------- */
function newQuestion(){
  document.getElementById("result").style.display="none";
  const diff=document.getElementById("difficulty").value;
  const base=(diff==="medium")?randomBaseMedium():randomBaseGeneral();
  currentBase=base;

  const count = diff==="easy"?1:rand(2,5);
  let hostReqs=[];
  if(diff==="medium"){
    const usable=Math.floor((2**(32-base.prefix))/count)-2;
    hostReqs=Array(count).fill(Math.max(30,Math.min(usable,4094)));
  }else{
    for(let i=0;i<count;i++) hostReqs.push(rand(10,200));
  }

  hostReqs.sort((a,b)=>b-a);

  const prefixes=hostReqs.map(hostsToPrefix);
  const total=prefixes.reduce((s,p)=>s+(2**(32-p)),0);
  if(total>2**(32-base.prefix)) return newQuestion();

  let cursor=base.net;
  current=[];
  prefixes.forEach(p=>{
    const size=2**(32-p);
    cursor=Math.ceil(cursor/size)*size;
    current.push(subnetInfo(cursor,p));
    cursor+=size;
  });
  expectedHosts=hostReqs;

  document.getElementById("question").style.display="";
  document.getElementById("question").innerHTML=`
<b>Assigned block:</b> <code>${intToIp(base.net)}/${base.prefix}</code>
<ul>${hostReqs.map((h,i)=>`<li>Subnet ${i+1}: ${h} hosts</li>`).join("")}</ul>
${diff==="hard"?`<div class="small"><i>Allocate largest subnets first to avoid fragmentation.</i></div>`:""}
`;
  renderInputs();
}

function renderInputs(){
  document.getElementById("inputs").innerHTML=current.map((_,i)=>`
<div class="subnet">
  <div class="subnetHeader">
    <b>Subnet ${i+1}</b>
    <span class="status" id="s${i}">—</span>
  </div>
  <div class="grid">
    <div><label>Mask</label><input data-i="${i}" data-f="mask"></div>
    <div><label>CIDR</label><input data-i="${i}" data-f="cidr"></div>
    <div><label>Network ID</label><input data-i="${i}" data-f="network"></div>
    <div><label>Broadcast</label><input data-i="${i}" data-f="broadcast"></div>
    <div><label>First usable (Gateway)</label><input data-i="${i}" data-f="gateway"></div>
    <div><label>Last usable</label><input data-i="${i}" data-f="last"></div>
  </div>
</div>`).join("");
}

/* ---------- checking ---------- */
function checkAnswers(){
  let ok=true, explain=[];
  current.forEach((c,i)=>{
    const box=document.querySelectorAll(".subnet")[i];
    const f=Object.fromEntries([...box.querySelectorAll("input")].map(x=>[x.dataset.f,x.value]));
    const good =
      f.mask===c.mask &&
      normalizeCidr(f.cidr)===`/${c.prefix}` &&
      normalizeIp(f.network)===c.network &&
      normalizeIp(f.broadcast)===c.broadcast &&
      normalizeIp(f.gateway)===c.gateway &&
      normalizeIp(f.last)===c.last;

    const s=document.getElementById("s"+i);
    s.textContent=good?"✔ Correct":"✖ Incorrect";
    s.className="status "+(good?"good":"bad");

    if(!good){
      ok=false;
      explain.push(
`Subnet ${i+1}
Mask: ${c.mask}
CIDR: /${c.prefix}
Network: ${c.network}
Broadcast: ${c.broadcast}
Gateway: ${c.gateway}
Last usable: ${c.last}`
      );
    }
  });

  const res=document.getElementById("result");
  res.style.display="";
  if(ok){
    res.innerHTML="<b style='color:var(--good)'>All subnets correct.</b>";
  }else{
    const link=buildAiLink(currentBase, expectedHosts);
    res.innerHTML=`
<details open>
<summary><b>Show correct answers</b></summary>
<pre>${explain.join("\n\n")}</pre>
<a href="${link}" target="_blank">Ask AI to explain how to solve this</a>
</details>`;
  }
}

newQuestion();
</script>

</body>
</html>
